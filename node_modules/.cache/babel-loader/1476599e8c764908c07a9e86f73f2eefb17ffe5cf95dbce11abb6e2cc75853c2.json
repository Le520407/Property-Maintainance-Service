{"ast":null,"code":"import React from'react';import{Navigate,useLocation}from'react-router-dom';import{useAuth}from'../../contexts/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProtectedRoute=_ref=>{let{children,requiredRole=null,requiredPermission=null,requireSuper=false}=_ref;const{user,loading}=useAuth();const location=useLocation();// 显示加载状态\nif(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-gray-600\",children:\"Checking authentication...\"})]})});}// 未登录用户重定向到登录页\nif(!user){return/*#__PURE__*/_jsx(Navigate,{to:\"/login\",state:{from:location},replace:true});}// 检查账户状态\nif(user.status!=='ACTIVE'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Account Inactive\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-6\",children:user.status==='PENDING'?'Your account is pending approval. Please contact support.':'Your account has been suspended. Please contact support.'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href='/contact',className:\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors\",children:\"Contact Support\"})]})});}// 检查角色权限\nif(requiredRole&&user.role!==requiredRole){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Access Denied\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 mb-6\",children:[\"You don't have permission to access this page. Required role: \",requiredRole]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.history.back(),className:\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-4\",children:\"Go Back\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href='/dashboard',className:\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors\",children:\"Go to Dashboard\"})]})});}// 检查管理员权限\nif(requiredRole==='admin'&&user.role!=='admin'){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Admin Access Required\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-6\",children:\"This page requires administrator privileges.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.history.back(),className:\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-4\",children:\"Go Back\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href='/dashboard',className:\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors\",children:\"Go to Dashboard\"})]})});}// 检查超级管理员权限\nif(requireSuper&&(!user.isSuper||user.role!=='admin')){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Super Admin Access Required\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-6\",children:\"This page requires super administrator privileges.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.history.back(),className:\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-4\",children:\"Go Back\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href='/dashboard',className:\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors\",children:\"Go to Dashboard\"})]})});}// 检查特定权限\nif(requiredPermission&&user.role==='admin'&&user.permissions&&!user.permissions.includes(requiredPermission)){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-4\",children:\"Insufficient Permissions\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 mb-6\",children:[\"You don't have the required permission: \",requiredPermission]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.history.back(),className:\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-4\",children:\"Go Back\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href='/dashboard',className:\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors\",children:\"Go to Dashboard\"})]})});}// 所有检查通过，渲染子组件\nreturn children;};export default ProtectedRoute;","map":{"version":3,"names":["React","Navigate","useLocation","useAuth","jsx","_jsx","jsxs","_jsxs","ProtectedRoute","_ref","children","requiredRole","requiredPermission","requireSuper","user","loading","location","className","to","state","from","replace","status","onClick","window","href","role","history","back","isSuper","permissions","includes"],"sources":["C:/Users/Le520/Documents/Property-Maintainance-Service/src/components/auth/ProtectedRoute.jsx"],"sourcesContent":["import React from 'react';\r\nimport { Navigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\n\r\nconst ProtectedRoute = ({ \r\n  children, \r\n  requiredRole = null, \r\n  requiredPermission = null,\r\n  requireSuper = false \r\n}) => {\r\n  const { user, loading } = useAuth();\r\n  const location = useLocation();\r\n\r\n  // 显示加载状态\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Checking authentication...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 未登录用户重定向到登录页\r\n  if (!user) {\r\n    return <Navigate to=\"/login\" state={{ from: location }} replace />;\r\n  }\r\n\r\n  // 检查账户状态\r\n  if (user.status !== 'ACTIVE') {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Account Inactive</h1>\r\n          <p className=\"text-gray-600 mb-6\">\r\n            {user.status === 'PENDING' \r\n              ? 'Your account is pending approval. Please contact support.'\r\n              : 'Your account has been suspended. Please contact support.'\r\n            }\r\n          </p>\r\n          <button\r\n            onClick={() => window.location.href = '/contact'}\r\n            className=\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors\"\r\n          >\r\n            Contact Support\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 检查角色权限\r\n  if (requiredRole && user.role !== requiredRole) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Access Denied</h1>\r\n          <p className=\"text-gray-600 mb-6\">\r\n            You don't have permission to access this page. Required role: {requiredRole}\r\n          </p>\r\n          <button\r\n            onClick={() => window.history.back()}\r\n            className=\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-4\"\r\n          >\r\n            Go Back\r\n          </button>\r\n          <button\r\n            onClick={() => window.location.href = '/dashboard'}\r\n            className=\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors\"\r\n          >\r\n            Go to Dashboard\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 检查管理员权限\r\n  if (requiredRole === 'admin' && user.role !== 'admin') {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Admin Access Required</h1>\r\n          <p className=\"text-gray-600 mb-6\">\r\n            This page requires administrator privileges.\r\n          </p>\r\n          <button\r\n            onClick={() => window.history.back()}\r\n            className=\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-4\"\r\n          >\r\n            Go Back\r\n          </button>\r\n          <button\r\n            onClick={() => window.location.href = '/dashboard'}\r\n            className=\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors\"\r\n          >\r\n            Go to Dashboard\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 检查超级管理员权限\r\n  if (requireSuper && (!user.isSuper || user.role !== 'admin')) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Super Admin Access Required</h1>\r\n          <p className=\"text-gray-600 mb-6\">\r\n            This page requires super administrator privileges.\r\n          </p>\r\n          <button\r\n            onClick={() => window.history.back()}\r\n            className=\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-4\"\r\n          >\r\n            Go Back\r\n          </button>\r\n          <button\r\n            onClick={() => window.location.href = '/dashboard'}\r\n            className=\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors\"\r\n          >\r\n            Go to Dashboard\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 检查特定权限\r\n  if (requiredPermission && user.role === 'admin' && user.permissions && !user.permissions.includes(requiredPermission)) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Insufficient Permissions</h1>\r\n          <p className=\"text-gray-600 mb-6\">\r\n            You don't have the required permission: {requiredPermission}\r\n          </p>\r\n          <button\r\n            onClick={() => window.history.back()}\r\n            className=\"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors mr-4\"\r\n          >\r\n            Go Back\r\n          </button>\r\n          <button\r\n            onClick={() => window.location.href = '/dashboard'}\r\n            className=\"bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors\"\r\n          >\r\n            Go to Dashboard\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 所有检查通过，渲染子组件\r\n  return children;\r\n};\r\n\r\nexport default ProtectedRoute;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}